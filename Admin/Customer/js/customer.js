(() => {
  const customers = {
    "Viết Thanh": {
      id: "Viết Thanh",
      initials: "HD",
      name: "Ngô Viết Thanh",
      email: "ngozthanh@gmail.com",
      segment: "vip",
      phone: "0378603430",
      addressShort: "Dong Hoa, Di An, Ho Chi Minh City",
      latestOrderId: "#10032",
      orderCount: 33,
      balance: "-12,480,000 đ",
      totalSpend: "94,560,000 đ",
      tags: ["VIP tier", "Broadcast opt-in", "Automation"],
      since: "17/10/2023",
      loyalty: "24 months with us",
      ordersRecent: "4 orders in the last 30 days",
      total: "94,560,000 đ",
      average: "Avg. 2,865,000 đ / order",
      balanceNote: "Outstanding balance for 3 festival orders not yet paid",
      updated: "26 minutes ago",
      orders: [
        {
          id: "#10032",
          total: "3,150,000 đ",
          time: "Today, 10:45",
          status: "Packing",
          balance: "-4,160,000 đ",
        },
        {
          id: "#10024",
          total: "2,980,000 đ",
          time: "3 days ago",
          status: "Delivered",
          balance: "-4,160,000 đ",
        },
        {
          id: "#10007",
          total: "2,650,000 đ",
          time: "1 week ago",
          status: "Delivered",
          balance: "-4,160,000 đ",
        },
      ],
      history: [
        {
          initials: "VT",
          title: "Call to confirm corporate brunch",
          time: "This morning",
          description: "Customer requested extra fruit salad for 15 people.",
        },
        {
          initials: "HD",
          title: "Updated delivery address",
          time: "3 days ago",
          description: "Moved office to 182 Lê Đại Hành, District 11.",
        },
        {
          initials: "TN",
          title: "Added to Black Friday VIP campaign",
          time: "01/10/2025",
          description: "20% off Premium Eat Clean plan.",
        },
      ],
      ownerInitials: "VT",
      contactEmail: "ngozthanh@gmail.com",
      phoneDetail: "--",
      address: "Bcons Green Topaz Apartment, Dong Hoa, Di An, Ho Chi Minh City",
      tax: "E-invoice not registered",
      rating: 4,
      ratingNote: "Monitor receivables closely during holidays.",
      group: "vip",
      note: "Prioritize morning delivery slots and add detox juice.",
      tagsCloud: ["Eat Clean", "Loyal customer", "Postpaid"],
    },
    "thanh-nguyen": {
      id: "thanh-nguyen",
      initials: "TN",
      name: "Nguyễn Thanh",
      email: "thanh.nguyen@example.com",
      segment: "vip",
      phone: "0987 654 321",
      addressShort: "Thu Duc, Ho Chi Minh City",
      latestOrderId: "#10012",
      orderCount: 21,
      balance: "0 đ",
      totalSpend: "43,890,000 đ",
      tags: ["Subscription", "Morning delivery"],
      since: "12/04/2024",
      loyalty: "Morning meal subscriber for 18 months",
      ordersRecent: "2 orders in the last 30 days",
      total: "43,890,000 đ",
      average: "Avg. 2,090,000 đ / order",
      balanceNote: "Auto-payment via e-wallet",
      updated: "1 hour ago",
      orders: [
        { id: "#10012", total: "2,150,000 đ", time: "45 minutes ago", status: "Out for delivery", balance: "0 đ" },
        { id: "#10008", total: "1,980,000 đ", time: "3 days ago", status: "Delivered", balance: "0 đ" },
        { id: "#10001", total: "2,120,000 đ", time: "1 week ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "TN",
          title: "Extend Eat Clean plan for 30 days",
          time: "Today, 08:15",
          description: "Keep current menu, add celery juice on Wednesdays.",
        },
        {
          initials: "CS",
          title: "5-star service rating",
          time: "Last week",
          description: "Customer praised consistent delivery and neat packaging.",
        },
      ],
      ownerInitials: "TN",
      contactEmail: "thanh.nguyen@example.com",
      phoneDetail: "0987 654 321",
      address: "Opal Boulevard Apartment, Thu Duc, Ho Chi Minh City",
      tax: "Tax ID: 0312456789",
      rating: 5,
      ratingNote: "Loyal customer, refers many friends.",
      group: "vip",
      note: "Always deliver before 7 AM, leave at reception.",
      tagsCloud: ["Subscription", "Morning", "Detox"],
    },
    "quoc-thinh": {
      id: "quoc-thinh",
      initials: "QT",
      name: "Trần Quốc Thịnh",
      email: "qt.fitmeal@example.com",
      segment: "loyal",
      phone: "0903 888 999",
      addressShort: "District 1, Ho Chi Minh City",
      latestOrderId: "#10031",
      orderCount: 18,
      balance: "-2,540,000 đ",
      totalSpend: "36,540,000 đ",
      tags: ["Gym member", "High protein"],
      since: "28/08/2024",
      loyalty: "Fitness customer for 14 months",
      ordersRecent: "1 order in the last 30 days",
      total: "36,540,000 đ",
      average: "Avg. 2,030,000 đ / order",
      balanceNote: "Outstanding for October protein package",
      updated: "32 minutes ago",
      orders: [
        { id: "#10031", total: "2,250,000 đ", time: "30 minutes ago", status: "Pending payment", balance: "-2,540,000 đ" },
        { id: "#10014", total: "1,780,000 đ", time: "2 weeks ago", status: "Delivered", balance: "0 đ" },
        { id: "#10006", total: "2,040,000 đ", time: "Last month", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "NV",
          title: "Sent High Protein 2,000 kcal menu",
          time: "Yesterday, 17:00",
          description: "Customer wants more salmon and chicken breast.",
        },
        {
          initials: "QT",
          title: "Flavor feedback",
          time: "Last month",
          description: "Suggested reducing the sweetness of teriyaki sauce.",
        },
        ],
      ownerInitials: "NV",
      contactEmail: "qt.fitmeal@example.com",
      phoneDetail: "0903 888 999",
      address: "88 Nguyễn Du, District 1, Ho Chi Minh City",
      tax: "E-invoice activated",
      rating: 4,
      ratingNote: "Monitor receivables and low-carb portions.",
      group: "loyal",
      note: "Deliver after workout (7 PM), include whey sample.",
      tagsCloud: ["High protein", "Evening delivery", "Gym"],
    },
    "viet-ha": {
      id: "viet-ha",
      initials: "VH",
      name: "Việt Hà",
      email: "viet.ha@example.com",
      segment: "inactive",
      phone: "0912 345 678",
      addressShort: "District 3, Ho Chi Minh City",
      latestOrderId: "#9821",
      orderCount: 5,
      balance: "0 đ",
      totalSpend: "8,920,000 đ",
      tags: ["Inactive", "Flash sale"],
      since: "14/03/2023",
      loyalty: "No orders in the last 90 days",
      ordersRecent: "No orders in the last 90 days",
      total: "8,920,000 đ",
      average: "Avg. 1,784,000 đ / order",
      balanceNote: "No outstanding balance",
      updated: "3 months ago",
      orders: [
        { id: "#9821", total: "1,250,000 đ", time: "3 months ago", status: "Delivered", balance: "0 đ" },
        { id: "#9512", total: "1,080,000 đ", time: "4 months ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "CS",
          title: "Sent October reactivation campaign",
          time: "30/09/2025",
          description: "20% off seafood combo for return customers.",
        },
        {
          initials: "VH",
          title: "Notice of temporary pause",
          time: "June 2025",
          description: "Business trip to Hanoi for an extended period.",
        },
      ],
      ownerInitials: "CS",
      contactEmail: "viet.ha@example.com",
      phoneDetail: "0912 345 678",
      address: "Yersin Street, Nha Trang, Khanh Hoa",
      tax: "Not provided",
      rating: 3,
      ratingNote: "Needs personalized offer to return.",
      group: "inactive",
      note: "Call back in December after the trip ends.",
      tagsCloud: ["Inactive", "Holiday", "Email"],
    },
    "ngoc-anh": {
      id: "ngoc-anh",
      initials: "NA",
      name: "Phạm Ngọc Anh",
      email: "ngoc.anh@example.com",
      segment: "vip",
      phone: "0901 234 567",
      addressShort: "District 7, Ho Chi Minh City",
      latestOrderId: "#10018",
      orderCount: 24,
      balance: "0 đ",
      totalSpend: "54,720,000 đ",
      tags: ["VIP", "Morning delivery"],
      since: "05/01/2024",
      loyalty: "Healthy brunch package for 18 months",
      ordersRecent: "3 orders in the last 30 days",
      total: "54,720,000 đ",
      average: "Avg. 2,280,000 đ / order",
      balanceNote: "Automatic card payment",
      updated: "58 minutes ago",
      orders: [
        { id: "#10018", total: "2,450,000 đ", time: "Today, 07:30", status: "Delivered", balance: "0 đ" },
        { id: "#10005", total: "2,280,000 đ", time: "5 days ago", status: "Delivered", balance: "0 đ" },
        { id: "#10001", total: "2,360,000 đ", time: "2 weeks ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "NA",
          title: "Upgraded to premium brunch package",
          time: "This week",
          description: "Add granola and cold-pressed juice.",
        },
        {
          initials: "CS",
          title: "Sent experience survey",
          time: "Last week",
          description: "Customer asked for more light vegetarian options.",
        },
      ],
      ownerInitials: "CS",
      contactEmail: "ngoc.anh@example.com",
      phoneDetail: "0901 234 567",
      address: "Sunrise Riverside, District 7, Ho Chi Minh City",
      tax: "Tax ID: 0314598789",
      rating: 5,
      ratingNote: "Punctual VIP; prefers personalized brunch set.",
      group: "vip",
      note: "Add lemon-grass detox juice every Monday morning.",
      tagsCloud: ["Premium", "Detox", "Brunch"],
    },
    "minh-tam": {
      id: "minh-tam",
      initials: "MT",
      name: "Võ Minh Tâm",
      email: "minh.tam@example.com",
      segment: "loyal",
      phone: "0985 777 321",
      addressShort: "Binh Thanh, Ho Chi Minh City",
      latestOrderId: "#10014",
      orderCount: 17,
      balance: "-1,200,000 đ",
      totalSpend: "35,960,000 đ",
      tags: ["High protein", "Gym"],
      since: "22/08/2024",
      loyalty: "Fit24 gym member",
      ordersRecent: "2 orders in the last 30 days",
      total: "35,960,000 đ",
      average: "Avg. 2,115,000 đ / order",
      balanceNote: "Outstanding for September protein order",
      updated: "2 hours ago",
      orders: [
        { id: "#10014", total: "2,650,000 đ", time: "This morning", status: "Pending payment", balance: "-1,200,000 đ" },
        { id: "#10009", total: "2,180,000 đ", time: "6 days ago", status: "Delivered", balance: "0 đ" },
        { id: "#9998", total: "2,040,000 đ", time: "3 weeks ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "HN",
          title: "Payment reminder for outstanding balance",
          time: "This morning",
          description: "Customer will transfer after the evening workout.",
        },
        {
          initials: "MT",
          title: "Adjusted macros",
          time: "Last week",
          description: "Reduce carbs by 20%, increase salmon.",
        },
      ],
      ownerInitials: "HN",
      contactEmail: "minh.tam@example.com",
      phoneDetail: "0985 777 321",
      address: "Saigon Pearl, Binh Thanh, Ho Chi Minh City",
      tax: "Not provided",
      rating: 4,
      ratingNote: "Monitor receivables and low-carb menu.",
      group: "loyal",
      note: "Add vanilla whey shake to Saturday order.",
      tagsCloud: ["Gym", "Low carb", "Protein"],
    },
    "tuan-anh": {
      id: "tuan-anh",
      initials: "TA",
      name: "Ngô Tuấn Anh",
      email: "tuananh@example.com",
      segment: "loyal",
      phone: "0909 112 889",
      addressShort: "Dong Da, Hanoi",
      latestOrderId: "#10027",
      orderCount: 28,
      balance: "0 đ",
      totalSpend: "53,400,000 đ",
      tags: ["Corporate", "Lunch plan"],
      since: "10/03/2023",
      loyalty: "Corporate client for 24 months",
      ordersRecent: "4 orders in the last 30 days",
      total: "53,400,000 đ",
      average: "Avg. 1,907,143 đ / order",
      balanceNote: "Monthly periodic payment",
      updated: "Yesterday, 16:00",
      orders: [
        { id: "#10027", total: "1,950,000 đ", time: "Yesterday", status: "Out for delivery", balance: "0 đ" },
        { id: "#10021", total: "2,050,000 đ", time: "3 days ago", status: "Delivered", balance: "0 đ" },
        { id: "#10015", total: "1,880,000 đ", time: "1 week ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "TA",
          title: "Add low-carb portions for sales team",
          time: "Yesterday",
          description: "5 low-carb lunches, deliver at 11:30.",
        },
        {
          initials: "HN",
          title: "Customer support proposed Corporate Premium",
          time: "Last week",
          description: "Customer considering upgrade in November.",
        },
      ],
      ownerInitials: "HN",
      contactEmail: "tuananh@example.com",
      phoneDetail: "0909 112 889",
      address: "VIT Building, Dong Da, Hanoi",
      tax: "Tax ID: 0109876543",
      rating: 4,
      ratingNote: "Stable schedule; prioritize on-time lunch delivery.",
      group: "loyal",
      note: "Contact assistant Lan before delivery to get elevator card.",
      tagsCloud: ["Corporate", "Lunch", "Hanoi"],
    },
    "kim-yen": {
      id: "kim-yen",
      initials: "KY",
      name: "Lý Kim Yến",
      email: "kimyen@example.com",
      segment: "vip",
      phone: "0966 555 048",
      addressShort: "Thao Dien, Ho Chi Minh City",
      latestOrderId: "#10019",
      orderCount: 19,
      balance: "0 đ",
      totalSpend: "46,820,000 đ",
      tags: ["Gluten-free", "Brunch"],
      since: "18/06/2024",
      loyalty: "Healthy brunch customer for 14 months",
      ordersRecent: "2 orders in the last 30 days",
      total: "46,820,000 đ",
      average: "Avg. 2,463,157 đ / order",
      balanceNote: "Paid by credit card",
      updated: "2 hours ago",
      orders: [
        { id: "#10019", total: "2,680,000 đ", time: "2 hours ago", status: "Preparing", balance: "0 đ" },
        { id: "#10010", total: "2,540,000 đ", time: "6 days ago", status: "Delivered", balance: "0 đ" },
        { id: "#10002", total: "2,480,000 đ", time: "2 weeks ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "KY",
          title: "Request gluten-free menu",
          time: "This morning",
          description: "Replace regular bread with almond bread.",
        },
        {
          initials: "CS",
          title: "Birthday voucher gifted",
          time: "Last week",
          description: "Customer used voucher for order #10019.",
        },
      ],
      ownerInitials: "CS",
      contactEmail: "kimyen@example.com",
      phoneDetail: "0966 555 048",
      address: "Masteri Thao Dien, District 2, Ho Chi Minh City",
      tax: "No invoice requested yet",
      rating: 5,
      ratingNote: "Prioritize weekend brunch and gluten-free items.",
      group: "vip",
      note: "Deliver on Sunday before 9 AM, add fruit tea.",
      tagsCloud: ["Gluten-free", "Brunch", "Weekend"],
    },
    "bao-tran": {
      id: "bao-tran",
      initials: "BT",
      name: "Đinh Bảo Trân",
      email: "bao.tran@example.com",
      segment: "inactive",
      phone: "0912 468 802",
      addressShort: "Quy Nhon, Binh Dinh",
      latestOrderId: "#9721",
      orderCount: 9,
      balance: "0 đ",
      totalSpend: "16,320,000 đ",
      tags: ["Inactive", "Holiday"],
      since: "12/11/2023",
      loyalty: "Out-of-province customer for 1 year",
      ordersRecent: "No orders in the last 90 days",
      total: "16,320,000 đ",
      average: "Avg. 1,813,333 đ / order",
      balanceNote: "No outstanding balance",
      updated: "3 months ago",
      orders: [
        { id: "#9721", total: "1,920,000 đ", time: "3 months ago", status: "Delivered", balance: "0 đ" },
        { id: "#9488", total: "1,680,000 đ", time: "4 months ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "CS",
          title: "Sent reactivation email",
          time: "Last month",
          description: "Holiday offer -15% for family combo.",
        },
        {
          initials: "BT",
          title: "Notice of temporary pause",
          time: "5 months ago",
          description: "Business trip abroad for 6 months.",
        },
      ],
      ownerInitials: "CS",
      contactEmail: "bao.tran@example.com",
      phoneDetail: "0912 468 802",
      address: "Ghenh Rang Ward, Quy Nhon, Binh Dinh",
      tax: "Not registered",
      rating: 3,
      ratingNote: "Potential return around Tet.",
      group: "inactive",
      note: "Call early December to offer Tet combo.",
      tagsCloud: ["Holiday", "Inactive", "Email"],
    },
    "quyen-dao": {
      id: "quyen-dao",
      initials: "QD",
      name: "Đào Khánh Quyên",
      email: "quyen.dao@example.com",
      segment: "vip",
      phone: "0908 654 210",
      addressShort: "District 3, Ho Chi Minh City",
      latestOrderId: "#10025",
      orderCount: 31,
      balance: "0 đ",
      totalSpend: "68,940,000 đ",
      tags: ["Detox", "Tea lover"],
      since: "03/02/2023",
      loyalty: "VIP customer for 2 years",
      ordersRecent: "4 orders in the last 30 days",
      total: "68,940,000 đ",
      average: "Avg. 2,223,871 đ / order",
      balanceNote: "Company paid",
      updated: "28 minutes ago",
      orders: [
        { id: "#10025", total: "2,480,000 đ", time: "28 minutes ago", status: "Out for delivery", balance: "0 đ" },
        { id: "#10020", total: "2,660,000 đ", time: "2 days ago", status: "Delivered", balance: "0 đ" },
        { id: "#10012", total: "2,540,000 đ", time: "Last week", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "QD",
          title: "Created 7-day detox tea package",
          time: "This morning",
          description: "Deliver with fruit tea and nut snacks.",
        },
        {
          initials: "CS",
          title: "Invited to nutrition workshop",
          time: "Last week",
          description: "Customer confirmed attendance on 25/10.",
        },
      ],
      ownerInitials: "CS",
      contactEmail: "quyen.dao@example.com",
      phoneDetail: "0908 654 210",
      address: "Do Thanh Residential Area, District 3, Ho Chi Minh City",
      tax: "Tax ID: 0311231123",
      rating: 5,
      ratingNote: "VIP customer who loves detox and workshops.",
      group: "vip",
      note: "Prepare detox tea before 6:30 AM daily.",
      tagsCloud: ["Detox", "Tea", "Workshop"],
    },
    "tien-huy": {
      id: "tien-huy",
      initials: "TH",
      name: "Trịnh Tiến Huy",
      email: "tien.huy@example.com",
      segment: "loyal",
      phone: "0933 221 889",
      addressShort: "Hai Chau, Da Nang",
      latestOrderId: "#10011",
      orderCount: 16,
      balance: "-2,540,000 đ",
      totalSpend: "29,980,000 đ",
      tags: ["Family plan", "Dinner"],
      since: "14/04/2024",
      loyalty: "Family of 4 ordering dinners",
      ordersRecent: "1 order in the last 30 days",
      total: "29,980,000 đ",
      average: "Avg. 1,873,750 đ / order",
      balanceNote: "Awaiting COD collection for latest order",
      updated: "Yesterday, 19:00",
      orders: [
        { id: "#10011", total: "2,540,000 đ", time: "Yesterday", status: "Pending payment", balance: "-2,540,000 đ" },
        { id: "#10007", total: "1,980,000 đ", time: "10 days ago", status: "Delivered", balance: "0 đ" },
        { id: "#10004", total: "1,820,000 đ", time: "3 weeks ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "TH",
          title: "Request to extend COD payment",
          time: "Yesterday, 20:15",
          description: "Promised to pay on 20/10 due to business trip.",
        },
        {
          initials: "DN",
          title: "Proposed 28-meal family plan",
          time: "Last week",
          description: "Customer considering upgrade in November.",
        },
      ],
      ownerInitials: "DN",
      contactEmail: "tien.huy@example.com",
      phoneDetail: "0933 221 889",
      address: "36 Le Duan, Hai Chau, Da Nang",
      tax: "Not registered",
      rating: 4,
      ratingNote: "Keep a close eye on COD and kids' portions.",
      group: "loyal",
      note: "Add kid-friendly portion every Saturday.",
      tagsCloud: ["Family", "Dinner", "COD"],
    },
    "thanh-loc": {
      id: "thanh-loc",
      initials: "TL",
      name: "Huỳnh Thành Lộc",
      email: "thanh.loc@example.com",
      segment: "vip",
      phone: "0978 900 222",
      addressShort: "Can Tho",
      latestOrderId: "#10023",
      orderCount: 22,
      balance: "0 đ",
      totalSpend: "42,960,000 đ",
      tags: ["Business owner", "Low sugar"],
      since: "28/09/2023",
      loyalty: "VIP customer in the Mekong Delta",
      ordersRecent: "3 orders in the last 30 days",
      total: "42,960,000 đ",
      average: "Avg. 1,952,727 đ / order",
      balanceNote: "Corporate bank transfer",
      updated: "Today, 07:40",
      orders: [
        { id: "#10023", total: "2,240,000 đ", time: "Today", status: "Preparing", balance: "0 đ" },
        { id: "#10016", total: "2,160,000 đ", time: "4 days ago", status: "Delivered", balance: "0 đ" },
        { id: "#10008", total: "2,080,000 đ", time: "2 weeks ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "TL",
          title: "Request to reduce sugar in juice",
          time: "This morning",
          description: "Replace honey with stevia.",
        },
        {
          initials: "CT",
          title: "Achieved VIP tier in September",
          time: "Last month",
          description: "Gifted a 1,000,000 đ voucher.",
        },
      ],
      ownerInitials: "CT",
      contactEmail: "thanh.loc@example.com",
      phoneDetail: "0978 900 222",
      address: "Hung Phu Residential Area, Can Tho",
      tax: "Tax ID: 1800123456",
      rating: 5,
      ratingNote: "Responds quickly; prefers low-sugar items.",
      group: "vip",
      note: "Add stevia juice on Mondays and Thursdays.",
      tagsCloud: ["Low sugar", "Juice", "VIP"],
    },
    "mai-chi": {
      id: "mai-chi",
      initials: "MC",
      name: "Nguyễn Mai Chi",
      email: "mai.chi@example.com",
      segment: "loyal",
      phone: "0938 456 909",
      addressShort: "Nha Trang, Khanh Hoa",
      latestOrderId: "#10006",
      orderCount: 14,
      balance: "0 đ",
      totalSpend: "21,760,000 đ",
      tags: ["Pescatarian", "Smoothie lover"],
      since: "09/05/2024",
      loyalty: "Pesco customer for 10 months",
      ordersRecent: "2 orders in the last 30 days",
      total: "21,760,000 đ",
      average: "Avg. 1,554,286 đ / order",
      balanceNote: "E-wallet payment",
      updated: "2 days ago",
      orders: [
        { id: "#10006", total: "1,820,000 đ", time: "2 days ago", status: "Delivered", balance: "0 đ" },
        { id: "#9999", total: "1,760,000 đ", time: "8 days ago", status: "Delivered", balance: "0 đ" },
        { id: "#9991", total: "1,620,000 đ", time: "3 weeks ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "MC",
          title: "Switched to pesco menu",
          time: "Last month",
          description: "Only fish dishes and fruit smoothies.",
        },
        {
          initials: "NT",
          title: "Birthday coupon 15%",
          time: "Last week",
          description: "Applied to order #10006.",
        },
      ],
      ownerInitials: "NT",
      contactEmail: "mai.chi@example.com",
      phoneDetail: "0938 456 909",
      address: "Vinhomes Ocean Park, Nha Trang",
      tax: "Not provided",
      rating: 4,
      ratingNote: "Prefers fish dishes and mango smoothie.",
      group: "loyal",
      note: "Add mango smoothie every Wednesday.",
      tagsCloud: ["Smoothie", "Pescatarian", "Birthday"],
    },
    "phong-nguyen": {
      id: "phong-nguyen",
      initials: "PN",
      name: "Nguyễn Tuấn Phong",
      email: "tuan.phong@example.com",
      segment: "inactive",
      phone: "0974 888 665",
      addressShort: "Bien Hoa, Dong Nai",
      latestOrderId: "#9540",
      orderCount: 7,
      balance: "0 đ",
      totalSpend: "13,560,000 đ",
      tags: ["Office snack", "Inactive"],
      since: "04/07/2023",
      loyalty: "No orders in the last 120 days",
      ordersRecent: "No orders in the last 120 days",
      total: "13,560,000 đ",
      average: "Avg. 1,937,143 đ / order",
      balanceNote: "No outstanding balance",
      updated: "4 months ago",
      orders: [
        { id: "#9540", total: "1,960,000 đ", time: "4 months ago", status: "Delivered", balance: "0 đ" },
        { id: "#9320", total: "1,820,000 đ", time: "5 months ago", status: "Delivered", balance: "0 đ" },
      ],
      history: [
        {
          initials: "BD",
          title: "Sent new office snack combo",
          time: "This week",
          description: "Suggested returning with healthy office combo.",
        },
        {
          initials: "PN",
          title: "Notice of temporary pause",
          time: "4 months ago",
          description: "Changed company; will reorder after settling in.",
        },
      ],
      ownerInitials: "BD",
      contactEmail: "tuan.phong@example.com",
      phoneDetail: "0974 888 665",
      address: "Amata Industrial Park, Bien Hoa, Dong Nai",
      tax: "No request yet",
      rating: 3,
      ratingNote: "Potential returning customer; needs outreach.",
      group: "inactive",
      note: "Follow up early November with new snack combo.",
      tagsCloud: ["Office snack", "Inactive", "Email"],
    },
  };

  const CustomerData = {
    totalCustomers: 438,
    defaultCustomerId: "Viết Thanh",
    getAll() {
      return Object.values(customers);
    },
    getById(id) {
      return customers[id] || null;
    },
  };

  const state = {
    activeFilter: "all",
    searchTerm: "",
    currentCustomerId: null,
  };

  const listHeader = document.getElementById("list-header");
  const detailHeader = document.getElementById("detail-header");
  const listView = document.getElementById("customer-list-view");
  const detailViewContainer = document.getElementById("customer-detail-view");
  const totalCustomersLabel = document.getElementById("total-customers");
  const tabs = Array.from(document.querySelectorAll(".tab"));
  const searchInput = document.getElementById("search-input");
  const tableSummary = document.getElementById("table-summary");
  const emptyState = document.getElementById("empty-state");
  const clearFilters = document.getElementById("clear-filters");
  const selectAll = document.getElementById("select-all");
  const tbody = document.getElementById("customer-tbody");
  const detailBackBtn = document.getElementById("detail-back");

  const ui = {
    title: document.getElementById("detail-title"),
    avatar: document.getElementById("detail-avatar"),
    name: document.getElementById("detail-name"),
    email: document.getElementById("detail-email"),
    tags: document.getElementById("detail-tags"),
    since: document.getElementById("detail-since"),
    loyalty: document.getElementById("detail-loyalty"),
    orders: document.getElementById("detail-orders"),
    ordersRecent: document.getElementById("detail-orders-recent"),
    total: document.getElementById("detail-total"),
    average: document.getElementById("detail-average"),
    balance: document.getElementById("detail-balance"),
    balanceNote: document.getElementById("detail-balance-note"),
    updated: document.getElementById("detail-updated"),
    ordersList: document.getElementById("detail-orders-list"),
    history: document.getElementById("detail-history"),
    ownerAvatar: document.getElementById("detail-owner-avatar"),
    contactEmail: document.getElementById("detail-contact-email"),
    phone: document.getElementById("detail-phone"),
    address: document.getElementById("detail-address"),
    tax: document.getElementById("detail-tax"),
    rating: document.getElementById("detail-rating"),
    ratingNote: document.getElementById("detail-rating-note"),
    groupSelect: document.getElementById("group-select"),
    groupFeedback: document.getElementById("group-feedback"),
    noteField: document.getElementById("note-field"),
    tagField: document.getElementById("tag-field"),
    tagsCloud: document.getElementById("detail-tags-cloud"),
  };

  const customersList = CustomerData.getAll();

  const toggleViews = (showDetail) => {
    if (showDetail) {
      listHeader.hidden = true;
      listView.hidden = true;
      detailHeader.hidden = false;
      detailViewContainer.hidden = false;
    } else {
      listHeader.hidden = false;
      listView.hidden = false;
      detailHeader.hidden = true;
      detailViewContainer.hidden = true;
    }
  };

  const matchesFilter = (customer) => {
    if (state.activeFilter === "all") return true;
    return (customer.segment || "all") === state.activeFilter;
  };

  const matchesSearch = (customer) => {
    if (!state.searchTerm) return true;
    const haystack = [customer.name, customer.email, customer.phone, customer.addressShort]
      .filter(Boolean)
      .join(" ")
      .toLowerCase();
    return haystack.includes(state.searchTerm);
  };

  const updateSelectAllState = () => {
    if (!selectAll) return;
    const visibleCheckboxes = Array.from(tbody.querySelectorAll('tr:not([hidden]) input[type="checkbox"]'));
    if (visibleCheckboxes.length === 0) {
      selectAll.checked = false;
      selectAll.indeterminate = false;
      return;
    }

    const checkedCount = visibleCheckboxes.filter((input) => input.checked).length;
    selectAll.checked = checkedCount === visibleCheckboxes.length;
    selectAll.indeterminate = checkedCount > 0 && checkedCount < visibleCheckboxes.length;
  };

  const createTagPill = (label) => {
    const tag = document.createElement("span");
    tag.className = "tag-pill";
    tag.textContent = label;
    return tag;
  };

  const renderOrders = (orders = []) => {
    if (!ui.ordersList) return;
    ui.ordersList.innerHTML = "";
    orders.forEach((order) => {
      const item = document.createElement("li");
      item.className = "orders-item";

      const left = document.createElement("div");
      const id = document.createElement("div");
      id.className = "order-id";
      id.textContent = order.id || "";
      const meta = document.createElement("div");
      meta.className = "order-meta";
      meta.textContent = `${order.status || ""}${order.time ? ` • ${order.time}` : ""}`;
      left.append(id, meta);

      const right = document.createElement("div");
      right.className = "orders-meta";
      const total = document.createElement("div");
      total.className = "order-total";
      total.textContent = order.total || "";
      const balance = document.createElement("div");
      balance.className = "order-meta";
      balance.textContent = order.balance || "";
      right.append(total, balance);

      item.append(left, right);
      ui.ordersList.appendChild(item);
    });
  };

  const renderHistory = (entries = []) => {
    if (!ui.history) return;
    ui.history.innerHTML = "";

    entries.forEach((entry) => {
      const wrap = document.createElement("div");
      wrap.className = "history-item";

      const stem = document.createElement("div");
      stem.className = "stem";

      const marker = document.createElement("div");
      marker.className = "avatar small";
      marker.textContent = entry.initials || "";
      stem.appendChild(marker);

      const bubble = document.createElement("div");
      bubble.className = "bubble";

      const title = document.createElement("strong");
      title.textContent = entry.title || "";

      const time = document.createElement("p");
      time.className = "muted";
      time.textContent = entry.time || "";

      const desc = document.createElement("p");
      desc.textContent = entry.description || "";

      bubble.append(title, time, desc);
      wrap.append(stem, bubble);
      ui.history.appendChild(wrap);
    });
  };

  const renderRating = (rating = 0) => {
    if (!ui.rating) return;
    ui.rating.innerHTML = "";
    for (let i = 1; i <= 5; i += 1) {
      const star = document.createElement("span");
      star.textContent = i <= rating ? "★" : "☆";
      ui.rating.appendChild(star);
    }
  };

  const renderDetail = (customer) => {
    if (ui.title) ui.title.textContent = customer.name || "Customer Detail";
    if (ui.avatar) ui.avatar.textContent = customer.initials || "";
    if (ui.name) ui.name.textContent = customer.name || "";
    if (ui.email) ui.email.textContent = customer.email || "";
    if (ui.tags) {
      ui.tags.innerHTML = "";
      (customer.tags || []).forEach((tag) => ui.tags.appendChild(createTagPill(tag)));
    }
    if (ui.since) ui.since.textContent = customer.since || "—";
    if (ui.loyalty) ui.loyalty.textContent = customer.loyalty || "";
    if (ui.orders) ui.orders.textContent = customer.orderCount != null ? customer.orderCount : "0";
    if (ui.ordersRecent) ui.ordersRecent.textContent = customer.ordersRecent || "";
    if (ui.total) ui.total.textContent = customer.total || "0 đ";
    if (ui.average) ui.average.textContent = customer.average || "";
    if (ui.balance) {
      ui.balance.textContent = customer.balance || "0 đ";
      ui.balance.classList.toggle("negative", (customer.balance || "").includes("-"));
    }
    if (ui.balanceNote) ui.balanceNote.textContent = customer.balanceNote || "";
    if (ui.updated) ui.updated.textContent = customer.updated || "";

    renderOrders(customer.orders);
    renderHistory(customer.history);
    renderRating(customer.rating);

    if (ui.ratingNote) ui.ratingNote.textContent = customer.ratingNote || "";
    if (ui.ownerAvatar) ui.ownerAvatar.textContent = customer.ownerInitials || "";
    if (ui.contactEmail) ui.contactEmail.textContent = customer.contactEmail || customer.email || "";
    if (ui.phone) ui.phone.textContent = customer.phoneDetail || customer.phone || "--";
    if (ui.address) ui.address.textContent = customer.address || "";
    if (ui.tax) ui.tax.textContent = customer.tax || "";

    if (ui.groupSelect) ui.groupSelect.value = customer.group || "";
    if (ui.noteField) ui.noteField.value = customer.note || "";
    if (ui.tagField) ui.tagField.value = "";
    if (ui.tagsCloud) {
      ui.tagsCloud.innerHTML = "";
      (customer.tagsCloud || []).forEach((tag) => ui.tagsCloud.appendChild(createTagPill(tag)));
    }

    if (ui.groupFeedback) ui.groupFeedback.hidden = true;
  };

  const createRow = (customer) => {
    const tr = document.createElement("tr");
    tr.className = "customer-row";
    tr.dataset.customerId = customer.id;
    tr.dataset.segment = customer.segment || "all";
    tr.tabIndex = 0;

    const checkboxCell = document.createElement("td");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkboxCell.appendChild(checkbox);

    const customerCell = document.createElement("td");
    const cellWrap = document.createElement("div");
    cellWrap.className = "customer-cell";

    const avatar = document.createElement("span");
    avatar.className = "avatar";
    avatar.textContent = customer.initials || "";

    const infoWrap = document.createElement("div");
    const nameLink = document.createElement("a");
    nameLink.className = "customer-name";
    nameLink.href = `customer.html?id=${customer.id}`;
    nameLink.textContent = customer.name;

    const sub = document.createElement("p");
    sub.className = "customer-sub";
    sub.textContent = customer.email || "";

    infoWrap.append(nameLink, sub);
    cellWrap.append(avatar, infoWrap);
    customerCell.appendChild(cellWrap);

    const phoneCell = document.createElement("td");
    phoneCell.textContent = customer.phone || "--";

    const addressCell = document.createElement("td");
    addressCell.textContent = customer.addressShort || "—";

    const latestOrderCell = document.createElement("td");
    if (customer.latestOrderId) {
      const link = document.createElement("a");
      link.href = "#";
      link.textContent = customer.latestOrderId;
      latestOrderCell.appendChild(link);
    } else {
      latestOrderCell.textContent = "—";
    }

    const orderCountCell = document.createElement("td");
    orderCountCell.textContent = customer.orderCount != null ? customer.orderCount : "—";

    const balanceCell = document.createElement("td");
    balanceCell.className = `money${customer.balance?.includes("-") ? " negative" : ""}`;
    balanceCell.textContent = customer.balance || "0 đ";

    const totalCell = document.createElement("td");
    totalCell.className = "money";
    totalCell.textContent = customer.totalSpend || "0 đ";

    tr.append(
      checkboxCell,
      customerCell,
      phoneCell,
      addressCell,
      latestOrderCell,
      orderCountCell,
      balanceCell,
      totalCell,
    );

    checkbox.addEventListener("change", updateSelectAllState);

    tr.addEventListener("click", (event) => {
      if (event.target === checkbox) {
        return;
      }
      window.location.href = `customer.html?id=${customer.id}`;
    });

    tr.addEventListener("keydown", (event) => {
      if (event.key === "Enter" || event.key === " ") {
        event.preventDefault();
        window.location.href = `customer.html?id=${customer.id}`;
      }
    });

    return tr;
  };

  const renderList = () => {
    tbody.innerHTML = "";
    const visible = customersList.filter((customer) => matchesFilter(customer) && matchesSearch(customer));

    visible.forEach((customer) => {
      tbody.appendChild(createRow(customer));
    });

    if (tableSummary) {
      tableSummary.textContent = `Showing ${visible.length} of ${CustomerData.totalCustomers || customersList.length} customers`;
    }

    if (emptyState) {
      emptyState.hidden = visible.length > 0;
    }

    if (selectAll) {
      selectAll.checked = false;
      selectAll.indeterminate = false;
    }
  };

  const showList = () => {
    toggleViews(false);
    state.currentCustomerId = null;
  };

  const showDetail = (customerId) => {
    const customer = CustomerData.getById(customerId);
    if (!customer) {
      showList();
      return;
    }

    renderDetail(customer);
    toggleViews(true);
    state.currentCustomerId = customerId;
  };

  if (totalCustomersLabel) {
    totalCustomersLabel.textContent = CustomerData.totalCustomers || customersList.length;
  }

  tabs.forEach((tab) => {
    tab.addEventListener("click", () => {
      tabs.forEach((item) => item.classList.remove("active"));
      tab.classList.add("active");
      state.activeFilter = tab.dataset.filter || "all";
      renderList();
      updateSelectAllState();
    });
  });

  searchInput?.addEventListener("input", (event) => {
    state.searchTerm = event.target.value.trim().toLowerCase();
    renderList();
    updateSelectAllState();
  });

  selectAll?.addEventListener("change", () => {
    const visibleCheckboxes = Array.from(tbody.querySelectorAll('tr:not([hidden]) input[type="checkbox"]'));
    visibleCheckboxes.forEach((input) => {
      input.checked = selectAll.checked;
    });
    selectAll.indeterminate = false;
  });

  clearFilters?.addEventListener("click", () => {
    state.activeFilter = "all";
    state.searchTerm = "";
    if (searchInput) searchInput.value = "";
    tabs.forEach((tab, index) => tab.classList.toggle("active", index === 0));
    renderList();
    updateSelectAllState();
  });

  detailBackBtn?.addEventListener("click", () => {
    window.location.href = "customer.html";
  });

  ui.groupSelect?.addEventListener("change", () => {
    if (ui.groupFeedback) ui.groupFeedback.hidden = true;
  });

  document.getElementById("save-group")?.addEventListener("click", () => {
    if (!state.currentCustomerId) return;
    const customer = CustomerData.getById(state.currentCustomerId);
    if (!customer) return;

    const selected = ui.groupSelect?.value || "";
    customer.group = selected;
    customer.segment = selected || "all";

    if (ui.groupFeedback) {
      ui.groupFeedback.textContent = selected
        ? `Group saved: ${selected.toUpperCase()}`
        : "Group cleared for this customer.";
      ui.groupFeedback.hidden = false;
    }

    renderList();
  });

  renderList();

  const initialParams = new URLSearchParams(window.location.search);
  const initialId = initialParams.get("id");
  if (initialId) {
    showDetail(initialId);
  } else {
    showList();
  }
})();
